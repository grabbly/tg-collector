# ArchiveDrop Web Interface - Apache2 Configuration

<VirtualHost *:80>
    ServerName tg-collector.acebox.eu
    DocumentRoot /var/www/html
    
    # Security headers
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
    
    # Proxy to Flask app
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Main application
    ProxyPass / http://127.0.0.1:5000/
    ProxyPassReverse / http://127.0.0.1:5000/
    
    # WebSocket support (if needed in future)
    RewriteEngine on
    RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
    RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
    RewriteRule .* ws://127.0.0.1:5000%{REQUEST_URI} [P]
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/archive_error.log
    CustomLog ${APACHE_LOG_DIR}/archive_access.log combined
    
    # Optional: Rate limiting (requires mod_evasive)
    # DOSHashTableSize    2048
    # DOSPageCount        20
    # DOSPageInterval     1
    # DOSSiteCount        50
    # DOSSiteInterval     1
    # DOSBlockingPeriod   600
</VirtualHost>

# HTTPS version (uncomment after setting up SSL)
# <VirtualHost *:443>
#     ServerName tg-collector.acebox.eu
#     DocumentRoot /var/www/html
#     
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /path/to/ssl/certificate.crt
#     SSLCertificateKeyFile /path/to/ssl/private.key
#     # SSLCertificateChainFile /path/to/ssl/intermediate.crt
#     
#     # SSL Security
#     SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
#     SSLHonorCipherOrder off
#     SSLSessionTickets off
#     
#     # Security headers
#     Header always set Strict-Transport-Security "max-age=31536000"
#     Header always set X-Frame-Options DENY
#     Header always set X-Content-Type-Options nosniff
#     Header always set X-XSS-Protection "1; mode=block"
#     
#     # Same proxy configuration as HTTP
#     ProxyPreserveHost On
#     ProxyRequests Off
#     ProxyPass / http://127.0.0.1:5000/
#     ProxyPassReverse / http://127.0.0.1:5000/
#     
#     RewriteEngine on
#     RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
#     RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
#     RewriteRule .* ws://127.0.0.1:5000%{REQUEST_URI} [P]
#     
#     ErrorLog ${APACHE_LOG_DIR}/archive_ssl_error.log
#     CustomLog ${APACHE_LOG_DIR}/archive_ssl_access.log combined
# )